<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Pengiriman Customer</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; background: #fff; color: #111; }
    h2 { color: crimson; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 15px; background: crimson; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: darkred; }
    .popup { background: #fff7f7; border: 1px solid crimson; padding: 15px; margin-top: 20px; display: none; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>Form Pengiriman Barang</h2>
  <form id="formPengiriman">
    <label>Nama Customer: <input type="text" id="nama_customer" required></label>
    <label>Nomor HP: <input type="text" id="nomor_hp_customer" required></label>
    <label>Asal Kirim: <input type="text" id="asal_kirim" value="Logistik Kita, Mojokerto" required></label>
    <label>Tujuan Kirim: <input type="text" id="tujuan_kirim" required></label>
    <label>Nama Barang: <input type="text" id="nama_barang" required></label>
    <label>Berat (kg): <input type="number" id="berat_kg" required></label>
    <label>Jumlah Koli: <input type="number" id="jumlah_koli" required></label>
    <label>Panjang (cm): <input type="number" id="panjang_cm" required></label>
    <label>Lebar (cm): <input type="number" id="lebar_cm" required></label>
    <label>Tinggi (cm): <input type="number" id="tinggi_cm" required></label>
    <label>Layanan:
      <select id="layanan">
        <option value="reguler">Reguler</option>
        <option value="prioritas">Prioritas</option>
      </select>
    </label>
    <label>Referral:
      <select id="referral">
        <option value="tidak">Tidak</option>
        <option value="ya">Ya</option>
      </select>
    </label>
    <label>Petugas: <input type="text" id="nama_petugas" required></label>
    <button type="button" onclick="cekTarif()">Cek Tarif</button>
  </form>

  <div class="popup" id="popup"></div>

  <script>
    const supabase = supabase.createClient(
      "https://mrghlcedtafomwnznywf.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yZ2hsY2VkdGFmb213bnpueXdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMTAwMTcsImV4cCI6MjA2NTg4NjAxN30.vCLC9w8sT0-4uMLFt9c-3BsFeLVco68ajtsu2ZQUiWs"
    );

    let globalData = {};

    function cekTarif() {
      const berat = parseFloat(document.getElementById("berat_kg").value);
      const panjang = parseFloat(document.getElementById("panjang_cm").value);
      const lebar = parseFloat(document.getElementById("lebar_cm").value);
      const tinggi = parseFloat(document.getElementById("tinggi_cm").value);
      const volume = panjang * lebar * tinggi;

      let tarif = 0;
      if (berat <= 50) tarif = 125000;
      else if (berat <= 70) tarif = 125000 + (berat - 50) * 2200;
      else if (berat < 100) tarif = 125000 + (berat - 50) * 2500;
      else if (berat <= 264) tarif = berat * 1700;
      else tarif = 450000;

      globalData = {
        nomor_surat: "LK-SJ-" + Date.now(),
        tanggal_masuk: new Date().toISOString(),
        nama_customer: document.getElementById("nama_customer").value,
        nomor_hp_customer: document.getElementById("nomor_hp_customer").value,
        asal_kirim: document.getElementById("asal_kirim").value,
        tujuan_kirim: document.getElementById("tujuan_kirim").value,
        nama_barang: document.getElementById("nama_barang").value,
        berat_kg: berat,
        jumlah_koli: parseInt(document.getElementById("jumlah_koli").value),
        panjang_cm: panjang,
        lebar_cm: lebar,
        tinggi_cm: tinggi,
        volume_cm3: volume,
        jenis_armada: "Pickup Granmax",
        layanan: document.getElementById("layanan").value,
        referral: document.getElementById("referral").value,
        nama_petugas: document.getElementById("nama_petugas").value,
        tarif_pengiriman: tarif,
        biaya_bbm: 0,
        biaya_driver: 0,
        biaya_sewa_armada: 0,
        profit_kotor: 0,
        status_kirim: "pending"
      };

      const popup = document.getElementById("popup");
      popup.innerHTML = `
        <h3>Konfirmasi Pengiriman</h3>
        <p><strong>Nama:</strong> ${globalData.nama_customer}<br>
        <strong>Tujuan:</strong> ${globalData.tujuan_kirim}<br>
        <strong>Barang:</strong> ${globalData.nama_barang}<br>
        <strong>Berat:</strong> ${globalData.berat_kg} kg<br>
        <strong>Volume:</strong> ${volume} cm³<br>
        <strong>Tarif:</strong> Rp ${tarif.toLocaleString()}</p>
        <button onclick="kirimKeSupabase()">Customer Setuju</button>
      `;
      popup.style.display = "block";
    }

    async function kirimKeSupabase() {
      const { error } = await supabase.from("Data_Barang").insert([globalData]);
      if (error) {
        alert("❌ Gagal kirim data: " + error.message);
      } else {
        alert("✅ Data berhasil dikirim ke Supabase!");
        document.getElementById("formPengiriman").reset();
        document.getElementById("popup").innerHTML = "<p>✅ Data berhasil dikirim!</p>";
      }
    }
  </script>
</body>
</html>
