<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Pengiriman - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const supabase = createClient(
  "https://mrghlcedtafomwnznywf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yZ2hsY2VkdGFmb213bnpueXdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMTAwMTcsImV4cCI6MjA2NTg4NjAxN30.vCLC9w8sT0-4uMLFt9c-3BsFeLVco68ajtsu2ZQUiWs"
);

window.tampilkanData = async function () {
  const bulan = parseInt(document.getElementById("bulan").value);
  const tahun = parseInt(document.getElementById("tahun").value);

  let { data, error } = await supabase.from("Data_Barang").select("*");

  if (error) {
    alert("❌ Gagal mengambil data: " + error.message);
    return;
  }

  const hasilFilter = data.filter(item => {
    const tgl = new Date(item.tanggal_masuk);
    return tgl.getMonth() + 1 === bulan && tgl.getFullYear() === tahun;
  });

  const isiTabel = document.getElementById("isiTabel");
  isiTabel.innerHTML = "";
  hasilFilter.forEach(item => {
    isiTabel.innerHTML += `
      <tr>
        <td>${item.nomor_surat_jalan}</td>
        <td>${item.nama_customer}</td>
        <td>${item.tujuan_kirim}</td>
        <td>${item.tanggal_masuk}</td>
        <td>
          <button class="btn btn-sm btn-info" onclick='lihatDetail(${JSON.stringify(JSON.stringify(item))})'>Lihat</button>
        </td>
      </tr>
    `;
  });
};

window.lihatDetail = function (jsonData) {
  const data = JSON.parse(jsonData);
  document.getElementById("popupBody").innerHTML = `
    <strong>Nama Customer:</strong> ${data.nama_customer}<br>
    <strong>Tujuan:</strong> ${data.tujuan_kirim}<br>
    <strong>Tarif:</strong> Rp ${data.tarif_pengiriman?.toLocaleString("id-ID") || 0}
  `;
  const modal = new bootstrap.Modal(document.getElementById("detailModal"));
  modal.show();
}

  </script>
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-danger mb-4">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">📦 Admin - Data Pengiriman</span>
    </div>
  </nav>  <div class="container">
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="bulan">Bulan</label>
        <select id="bulan" class="form-select">
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>
      <div class="col-md-6">
        <label for="tahun">Tahun</label>
        <select id="tahun" class="form-select"></select>
      </div>
    </div>
    <button class="btn btn-danger mb-4" onclick="tampilkanData()">Tampilkan</button><table class="table table-bordered table-hover">
  <thead class="table-dark">
    <tr>
      <th>No. Surat</th>
      <th>Customer</th>
      <th>Tujuan</th>
      <th>Tanggal</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="isiTabel"></tbody>
</table>

  </div>  <!-- Modal -->  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detail Pengiriman</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="popupBody">
          <!-- detail akan muncul di sini -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-warning">Edit</button>
          <button class="btn btn-danger">Hapus</button>
        </div>
      </div>
    </div>
  </div>  <script>
    const tahun = new Date().getFullYear();
    const selectTahun = document.getElementById("tahun");
    for (let i = tahun; i >= 2022; i--) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.text = i;
      selectTahun.appendChild(opt);
    }
  </script>  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script></body>
</html>
