<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Pengiriman - Admin</title>
  <link rel="icon" type="image/png" href="logo_logistikkita.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff;
      color: #222;
    }
    .container { margin-top: 30px; }
    h2 { color: #dc3545; text-align: center; }
    label, select, input { width: 100%; padding: 8px; margin-top: 10px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; }
    .popup { background: rgba(0,0,0,0.4); padding: 20px; display: none; }
    .popup-content { background-color: #fff; padding: 20px; border-radius: 10px; }
    .popup-buttons button { margin-top: 10px; }
  </style>
</head>
<body>

  <div class="container">
    <header class="d-flex justify-content-between align-items-center">
      <h2>Data Pengiriman - Logistik Kita</h2>
      <button onclick="window.location.href='index.html'" class="btn btn-danger">Kembali ke Dashboard</button>
    </header>

    <div class="mb-4">
      <label for="monthYear">Pilih Bulan & Tahun</label>
      <input type="month" id="monthYear" class="form-control">
      <button class="btn btn-danger mt-3" onclick="tampilkanData()">Tampilkan</button>
    </div>

    <div id="tabelPengiriman" class="mt-4"></div>

    <!-- Popup untuk Lihat Detail -->
    <div id="popup" class="popup">
      <div class="popup-content">
        <h4>Detail Pengiriman</h4>
        <p id="detailData"></p>
        <div class="popup-buttons">
          <button class="btn btn-warning" onclick="editData()">Edit</button>
          <button class="btn btn-danger" onclick="hapusData()">Hapus</button>
          <button class="btn btn-secondary" onclick="tutupPopup()">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/+esm"></script>
  <script>
    const supabase = createClient('https://mrghlcedtafomwnznywf.supabase.co', 'YOUR_PUBLIC_ANON_KEY');

    // Menampilkan data pengiriman berdasarkan bulan dan tahun
    async function tampilkanData() {
      const bulanTahun = document.getElementById("monthYear").value;
      const [tahun, bulan] = bulanTahun.split("-");

      // Ambil data dari Supabase
      const { data, error } = await supabase
        .from('Data_Barang')
        .select('*')
        .like('tanggal_masuk', `${tahun}-${bulan}%`);

      if (error) {
        alert('Gagal mengambil data: ' + error.message);
        return;
      }

      // Tampilkan data ke tabel
      let tabelHTML = `<table class="table table-bordered">
        <thead>
          <tr>
            <th>Nomor Surat Jalan</th>
            <th>Nama Customer</th>
            <th>Nama Barang</th>
            <th>Berat (kg)</th>
            <th>Tarif</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>`;

      data.forEach(item => {
        tabelHTML += `
          <tr>
            <td>${item.nomor_surat_jalan}</td>
            <td>${item.nama_customer}</td>
            <td>${item.nama_barang}</td>
            <td>${item.berat_kg}</td>
            <td>${item.tarif_pengiriman}</td>
            <td><button class="btn btn-info" onclick="lihatDetail(${JSON.stringify(item)})">Lihat Detail</button></td>
          </tr>`;
      });

      tabelHTML += `</tbody></table>`;

      document.getElementById('tabelPengiriman').innerHTML = tabelHTML;
    }

    // Menampilkan detail pengiriman di popup
    function lihatDetail(data) {
      document.getElementById('popup').style.display = 'block';
      document.getElementById('detailData').innerHTML = `
        <strong>Nomor Surat Jalan:</strong> ${data.nomor_surat_jalan}<br>
        <strong>Nama Customer:</strong> ${data.nama_customer}<br>
        <strong>Nama Barang:</strong> ${data.nama_barang}<br>
        <strong>Berat (kg):</strong> ${data.berat_kg}<br>
        <strong>Tarif Pengiriman:</strong> Rp ${data.tarif_pengiriman.toLocaleString()}<br>
        <strong>Alamat Pengiriman:</strong> ${data.tujuan_kirim}`;
    }

    // Menutup popup
    function tutupPopup() {
      document.getElementById('popup').style.display = 'none';
    }

    // Fungsi edit (untuk percakapan lebih lanjut)
    function editData() {
      alert('Edit data pengiriman');
    }

    // Fungsi hapus (untuk percakapan lebih lanjut)
    function hapusData() {
      alert('Hapus data pengiriman');
    }
  </script>

</body>
</html>
