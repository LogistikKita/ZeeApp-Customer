<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Admin | Logistik Kita</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Inisialisasi Supabase
    const supabaseUrl = 'https://mrghlcedtafomwnznywf.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yZ2hsY2VkdGFmb213bnpueXdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMTAwMTcsImV4cCI6MjA2NTg4NjAxN30.vCLC9w8sT0-4uMLFt9c-3BsFeLVco68ajtsu2ZQUiWs';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);
  </script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
    }
    .sidebar {
      width: 5rem;
      background-color: black;
      color: white;
      padding: 1rem;
      transition: width 0.3s;
      overflow: hidden;
    }
    .sidebar.open {
      width: 16rem;
    }
    .sidebar h1 {
      color: #ef4444;
      font-size: 1.25rem;
      font-weight: bold;
      margin-top: 0.5rem;
    }
    .sidebar button {
      background: none;
      border: none;
      color: white;
      margin: 1rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .sidebar nav a {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 0.25rem;
      transition: background 0.3s;
    }
    .sidebar nav a:hover {
      background-color: #dc2626;
    }
    .menu-label {
      display: none;
    }
    .sidebar.open .menu-label,
    .sidebar.open #logoText {
      display: inline;
    }
    .content {
      margin-left: 5rem;
      padding: 1rem;
      transition: margin-left 0.3s;
    }
    .content.shifted {
      margin-left: 16rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #ef4444;
      color: white;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="flex flex-col items-start gap-2 mb-4">
      <img src="logo_logistikkita.png" alt="Logo" class="h-10" />
      <h1 id="logoText" class="hidden">Logistik Kita</h1>
    </div>

    <button onclick="toggleSidebar()">
      <i class="ph ph-list text-xl"></i>
      <span id="toggleLabel" class="text-sm menu-label">Buka Menu</span>
    </button>

    <nav>
      <a href="#"><i class="ph ph-gauge"></i><span class="menu-label">Dashboard</span></a>
      <a href="#"><i class="ph ph-truck"></i><span class="menu-label">Data Pengiriman</span></a>
      <a href="#"><i class="ph ph-pencil"></i><span class="menu-label">CRUD Tarif per Kg</span></a>
      <a href="#"><i class="ph ph-map-pin"></i><span class="menu-label">Carter & Tarif Khusus</span></a>
      <a href="#"><i class="ph ph-users"></i><span class="menu-label">Mitra Driver</span></a>
      <a href="#"><i class="ph ph-globe"></i><span class="menu-label">Monitoring Armada</span></a>
      <a href="#"><i class="ph ph-handshake"></i><span class="menu-label">Referral</span></a>
      <a href="#"><i class="ph ph-chart-bar"></i><span class="menu-label">Laporan & Rekap</span></a>
      <a href="#"><i class="ph ph-gear"></i><span class="menu-label">Pengaturan</span></a>
    </nav>
  </aside>

  <!-- Content -->
  <main id="mainContent" class="content">
    <h2>Data Pengiriman</h2>
    <div style="overflow-x:auto">
      <table id="tabelPengiriman">
        <thead>
          <tr>
            <th>No. Surat Jalan</th>
            <th>Tanggal</th>
            <th>Customer</th>
            <th>Tujuan</th>
            <th>Barang</th>
            <th>Armada</th>
            <th>Tarif</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <script>
    // Sidebar awal tertutup
    window.addEventListener('DOMContentLoaded', () => {
      toggleSidebar(false);
      fetchData();
    });

    function toggleSidebar(forceState) {
      const sidebar = document.getElementById("sidebar");
      const logoText = document.getElementById("logoText");
      const toggleLabel = document.getElementById("toggleLabel");
      const content = document.getElementById("mainContent");
      const isOpen = sidebar.classList.contains("open");

      const newState = typeof forceState === "boolean" ? forceState : !isOpen;

      if (newState) {
        sidebar.classList.add("open");
        content.classList.add("shifted");
        toggleLabel.innerText = "Tutup Menu";
      } else {
        sidebar.classList.remove("open");
        content.classList.remove("shifted");
        toggleLabel.innerText = "Buka Menu";
      }
    }

    async function fetchData() {
      const { data, error } = await supabase.from("Data_Barang").select("*").limit(50).order("tanggal_masuk", { ascending: false });

      if (error) {
        console.error("Gagal ambil data:", error.message);
        return;
      }

      const tbody = document.querySelector("#tabelPengiriman tbody");
      tbody.innerHTML = "";

      data.forEach(item => {
        const row = `
          <tr>
            <td>${item.nomor_surat_jalan}</td>
            <td>${item.tanggal_masuk}</td>
            <td>${item.nama_customer}</td>
            <td>${item.tujuan_kirim}</td>
            <td>${item.nama_barang}</td>
            <td>${item.jenis_armada}</td>
            <td>Rp${item.tarif_pengiriman?.toLocaleString("id-ID") || 0}</td>
            <td>${item.status_kirim}</td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }
  </script>
</body>
</html>
