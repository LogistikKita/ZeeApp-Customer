<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Pengiriman | Logistik Kita</title>
  <script src="https://unpkg.com/phosphor-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="flex bg-white text-sm">

  <!-- Sidebar -->
  <aside id="sidebar" class="w-0 overflow-hidden bg-black text-white flex flex-col p-4 transition-all duration-300">
    <div class="flex flex-col items-start gap-2 mb-4">
      <img src="logo_logistikkita.png" alt="Logo" class="h-8" />
      <h1 id="logoText" class="text-md font-bold text-red-500">Logistik Kita</h1>
    </div>
    <button onclick="toggleSidebar()" class="text-white hover:text-red-500 mb-4 flex items-center gap-2">
      <i class="ph ph-list text-lg"></i>
      <span id="toggleLabel" class="text-xs">Tutup Menu</span>
    </button>
    <nav id="menuLinks" class="flex flex-col gap-2">
      <a href="admin.html" class="flex items-center gap-2 hover:bg-red-600 px-3 py-2 rounded">
        <i class="ph ph-gauge"></i><span class="menu-label">Dashboard</span>
      </a>
      <a href="data_pengiriman.html" class="bg-red-700 flex items-center gap-2 px-3 py-2 rounded">
        <i class="ph ph-truck"></i><span class="menu-label">Data Pengiriman</span>
      </a>
      <!-- menu lainnya -->
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-4 transition-all duration-300">
    <button onclick="toggleSidebar()" class="text-black hover:text-red-500 mb-4 flex items-center gap-2">
      <i class="ph ph-list text-xl"></i>
      <span class="text-sm">Buka Menu</span>
    </button>

    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold text-red-600">Data Pengiriman</h2>
      <div class="flex gap-2 items-center">
        <select id="filterBulan" class="border border-gray-300 px-2 py-1 rounded">
          <option value="">Bulan</option>
          <option value="01">Januari</option>
          <option value="02">Februari</option>
          <option value="03">Maret</option>
          <option value="04">April</option>
          <option value="05">Mei</option>
          <option value="06">Juni</option>
          <option value="07">Juli</option>
          <option value="08">Agustus</option>
          <option value="09">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
        <select id="filterTahun" class="border border-gray-300 px-2 py-1 rounded">
          <option value="">Tahun</option>
          <script>
            const tahunIni = new Date().getFullYear();
            for (let i = tahunIni; i >= tahunIni - 5; i--) {
              document.write(`<option value="${i}">${i}</option>`);
            }
          </script>
        </select>
        <button onclick="loadData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded">
          Tampilkan
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-xs border">
        <thead class="bg-red-100">
          <tr>
            <th class="p-2 border">No</th>
            <th class="p-2 border">No Surat Jalan</th>
            <th class="p-2 border">Tanggal</th>
            <th class="p-2 border">Customer</th>
            <th class="p-2 border">Asal</th>
            <th class="p-2 border">Tujuan</th>
            <th class="p-2 border">Barang</th>
            <th class="p-2 border">Tarif</th>
            <th class="p-2 border">Status</th>
            <th class="p-2 border">Aksi</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>
    </div>
  </main>

  <!-- Popup Detail -->
  <div id="popupDetail" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
    <div class="bg-white p-6 rounded shadow-lg max-w-md w-full text-sm relative">
      <button onclick="tutupPopup()" class="absolute top-2 right-3 text-red-600">
        <i class="ph ph-x text-xl"></i>
      </button>
      <h3 class="text-lg font-bold mb-4 text-red-600">Detail Pengiriman</h3>
      <div id="detailContent" class="grid grid-cols-2 gap-2 text-xs">
        <!-- konten detail akan muncul di sini -->
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    const sidebar = document.getElementById("sidebar");
    const logoText = document.getElementById("logoText");
    const toggleLabel = document.getElementById("toggleLabel");

    function toggleSidebar() {
      if (sidebar.classList.contains("w-0")) {
        sidebar.classList.remove("w-0", "overflow-hidden");
        sidebar.classList.add("w-64");
        logoText.classList.remove("hidden");
        toggleLabel.textContent = "Tutup Menu";
      } else {
        sidebar.classList.add("w-0", "overflow-hidden");
        sidebar.classList.remove("w-64");
        logoText.classList.add("hidden");
        toggleLabel.textContent = "Buka Menu";
      }
    }

    const supabase = supabase.createClient(
      'https://mrghlcedtafomwnznywf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
    );

    async function loadData() {
      const bulan = document.getElementById("filterBulan").value;
      const tahun = document.getElementById("filterTahun").value;
      const { data, error } = await supabase
        .from('Data_Barang')
        .select("*");

      let filtered = data;
      if (bulan && tahun) {
        filtered = data.filter(item => {
          const tgl = new Date(item.tanggal_masuk);
          return (
            tgl.getMonth() + 1 === parseInt(bulan) &&
            tgl.getFullYear() === parseInt(tahun)
          );
        });
      }

      const tbody = document.getElementById("dataBody");
      tbody.innerHTML = "";
      filtered.forEach((item, index) => {
        tbody.innerHTML += `
          <tr class="border hover:bg-red-50">
            <td class="p-2 border">${index + 1}</td>
            <td class="p-2 border">${item.nomor_surat_jalan}</td>
            <td class="p-2 border">${item.tanggal_masuk}</td>
            <td class="p-2 border">${item.nama_customer}</td>
            <td class="p-2 border">${item.asal_kirim}</td>
            <td class="p-2 border">${item.tujuan_kirim}</td>
            <td class="p-2 border">${item.nama_barang}</td>
            <td class="p-2 border">Rp${item.tarif_pengiriman?.toLocaleString()}</td>
            <td class="p-2 border">${item.status_kirim}</td>
            <td class="p-2 border text-center">
              <button onclick='lihatDetail(${JSON.stringify(item)})' class="text-blue-600 underline">Lihat</button>
            </td>
          </tr>
        `;
      });
    }

    function lihatDetail(data) {
      const container = document.getElementById("detailContent");
      container.innerHTML = "";
      for (const [key, value] of Object.entries(data)) {
        container.innerHTML += `
          <div class="font-semibold">${key.replaceAll("_", " ")}</div>
          <div>: ${value}</div>
        `;
      }
      document.getElementById("popupDetail").classList.remove("hidden");
    }

    function tutupPopup() {
      document.getElementById("popupDetail").classList.add("hidden");
    }

    window.onload = () => {
      sidebar.classList.add("w-0", "overflow-hidden");
      logoText.classList.add("hidden");
      toggleLabel.textContent = "Buka Menu";
    };
  </script>
</body>
</html>
